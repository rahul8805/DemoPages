<!DOCTYPE html>
<html>
  <head>
  <style>
    html, body, div, canvas {
      margin: 0;
      padding: 0;
    }
  </style>
    <script>
      var ctx;
      var captured = false;;
      window.addEventListener("pointermove", function(event) {

        document.getElementById("x").innerHTML = Math.floor(event.pageX);
        document.getElementById("y").innerHTML = Math.floor(event.pageY);

        if(!captured)
          return;

        console.log("***************next***************");
        console.log("Coalesced -> ");
		for (let e of event.getCoalescedEvents()) {
          console.log("(" + e.pageX + ", " + e.pageY + ")");
          drawCoordinates(e.pageX, e.pageY, "#00ff00", 6);
        }

        var predicted_points = event.getPredictedEvents();
		if(predicted_points.length > 0) {
          console.log("Predicted -> ");
          for (let e of predicted_points) {
            console.log("(" + e.pageX + ", " + e.pageY + ")");
            drawCoordinates(e.pageX, e.pageY, "#ff0000", 3);
          }
        }

        drawCoordinates(event.pageX, event.pageY, "#0000ff", 12);
      });

      window.addEventListener("pointerdown", function(event) {
        captured = true;
      });

      window.addEventListener("pointerup", function(event) {
        captured = false;
      });

      function drawCoordinates(x, y, color, pointSize){
        ctx.beginPath();
        ctx.arc(x, y, pointSize, 0, Math.PI * 2, true);
        ctx.strokeStyle = color;
        ctx.stroke();
      }

      function onloadHandler() {
        // Create a canvas that extends the entire screen
        // and it will draw right over the other html elements, like buttons, etc
        var canvas = document.createElement("canvas");
        canvas.setAttribute("width", window.innerWidth);
        canvas.setAttribute("height", window.innerHeight);
        canvas.setAttribute("style", "position: fixed; left:0px; right:0px;");
        document.body.appendChild(canvas);
        ctx = canvas.getContext("2d");
      }
    </script>
  </head>
  <body onload="onloadHandler()">
    <div style="position: fixed; left:0px; right:0px">
      Event coalescing and prediction demo<br />
      Try pointerdown -> pointermove -> pointerup<br /><br />
      Info: Pointer co-ordinates: (<span id="x">0</span>, <span id="y">0</span>)<br />
      (Optional: See console log for even more details on predicted event coords)
    </div>
  </body>
</html>
